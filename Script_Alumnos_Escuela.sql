USE master;
GO

CREATE DATABASE ALUMNOS_EL_CONTENTO
GO

USE ALUMNOS_EL_CONTENTO
GO

CREATE TABLE ROLES
(DOCUMENTO BIGINT PRIMARY KEY NOT NULL,
NOMBRE NVARCHAR(100) NOT NULL,
TIPOROL NVARCHAR(50) NOT NULL)
GO

CREATE TABLE MATERIAS
(CODIGO VARCHAR(6) PRIMARY KEY NOT NULL,
NOMBREMATERIA NVARCHAR(50) NOT NULL)
GO

CREATE TABLE GRUPOS
(CODIGO VARCHAR(6) PRIMARY KEY NOT NULL,
CODMATERIA VARCHAR(6) FOREIGN KEY REFERENCES MATERIAS(CODIGO) NOT NULL,
NROESTUDIANTES INT DEFAULT 0)
GO

CREATE TABLE ESTUDIANTES
(DOCUMENTO BIGINT PRIMARY KEY NOT NULL,
NOMBRE NVARCHAR(100) NOT NULL,
FECHANACIMIENTO DATE NOT NULL,
CODGRUPO VARCHAR(6) FOREIGN KEY REFERENCES GRUPOS(CODIGO),
NOTA1 FLOAT DEFAULT NULL,
NOTA2 FLOAT DEFAULT NULL,
NOTA3 FLOAT DEFAULT NULL,
NOTA4 FLOAT DEFAULT NULL,
NOTA5 FLOAT DEFAULT NULL)
GO

INSERT INTO MATERIAS VALUES
('XYZ333', 'ALGEBRA LINEAL'),
('ABC111', 'GEOMETRIA VECTORIAL'),
('QWE444', 'INGLES'),
('ASD555', 'MATEMATICAS BASICAS')
GO

INSERT INTO GRUPOS(CODIGO, CODMATERIA) VALUES
('A1', 'XYZ333'),
('B1', 'ABC111'),
('A2', 'QWE444'),
('B2', 'ASD555')
GO

-- REALIZAR UN TRIGGER PARA SUMAR UN +1 A LA
-- TABLA 'GRUPOS' CADA VEZ QUE SE INGRESA UN
-- NUEVO ESTUDIANTE.
CREATE TRIGGER SUMARCANTESTUDIANTES ON ESTUDIANTES AFTER INSERT AS
	DECLARE @CODGRUPO VARCHAR(6)
	SELECT @CODGRUPO = CODGRUPO
	FROM inserted

	UPDATE GRUPOS
	SET NROESTUDIANTES = NROESTUDIANTES + 1
	WHERE CODIGO = @CODGRUPO
GO

-- REALIZAR UN TRIGGER PARA RESTAR -1 A LA
-- TABLA 'GRUPOS' CADA VEZ QUE SE BORRE UN
-- ESTUDIANTE.
CREATE TRIGGER RESTARCANTESTUDIANTES ON ESTUDIANTES AFTER INSERT AS
	DECLARE @CODGRUPO VARCHAR(6)
	SELECT @CODGRUPO = CODGRUPO
	FROM deleted

	UPDATE GRUPOS
	SET NROESTUDIANTES = NROESTUDIANTES - 1
	WHERE CODIGO = @CODGRUPO
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(135, 'CAROLINA ZAPATA RESTREPO', '2002-07-14', 'A1')
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(248, 'JUAN JOSE ACEVEDO CASTRO', '2000-12-01', 'B1')
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(349, 'ANDRES FELIPE CORTEZ BEDOYA', '2001-02-17', 'A2')
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(167, 'OSCAR GIRALDO GRISALES', '1999-05-20', 'B2')
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(963, 'SEBASTIAN LONDOÑO CASTAÑEDA', '2000-07-28', 'A1')
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(741, 'SANTIAGO BETANCUR RENDON', '1998-01-01', 'B1')
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(934, 'LUIZ DAVID PEDRAZA MOSQUERA', '2002-10-03', 'A2')
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(174, 'CRISTIAN SEGURA HERNANDEZ', '2001-06-02', 'B2')
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(795, 'SOFIA CORTES SANCHEZ', '1998-04-25', 'A1')
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(649, 'VANESA ARISTISABAL PELAEZ', '2002-02-28', 'B1')
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(983, 'CAROLINA CORDOBA RODRIGUEZ', '2001-11-24', 'A2')
GO

INSERT INTO ESTUDIANTES(DOCUMENTO, NOMBRE, FECHANACIMIENTO,CODGRUPO) VALUES
(444, 'DANIELA NAVARRO GOMEZ', '1999-09-11', 'B2')
GO

INSERT INTO ROLES VALUES
(135, 'CAROLINA ZAPATA RESTREPO', 'ESTUDIANTE'),
(248, 'JUAN JOSE ACEVEDO CASTRO', 'ESTUDIANTE'),
(349, 'ANDRES FELIPE CORTEZ BEDOYA', 'ESTUDIANTE'),
(167, 'OSCAR GIRALDO GRISALES', 'ESTUDIANTE'),
(963, 'SEBASTIAN LONDOÑO CASTAÑEDA', 'ESTUDIANTE'),
(741, 'SANTIAGO BETANCUR RENDON', 'ESTUDIANTE'),
(934, 'LUIZ DAVID PEDRAZA MOSQUERA', 'ESTUDIANTE'),
(174, 'CRISTIAN SEGURA HERNANDEZ', 'ESTUDIANTE'),
(795, 'SOFIA CORTES SANCHEZ', 'ESTUDIANTE'),
(649, 'VANESA ARISTISABAL PELAEZ', 'ESTUDIANTE'),
(983, 'CAROLINA CORDOBA RODRIGUEZ', 'ESTUDIANTE'),
(444, 'DANIELA NAVARRO GOMEZ', 'ESTUDIANTE'),
(4444, 'JACOBO OSORIO ZAPATA', 'ADMINISTRADOR')
GO